---

copyright:
  years: 2015, 2021
lastupdated: "2021-05-07"

keywords: IBM Event Streams, Kafka as a service, managed Apache Kafka

subcollection: EventStreams

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}
{:note: .note}


# Connecting to {{site.data.keyword.messagehub}}
{: #connecting}

Need to refresh topic includes info for Lite plan. 
{: note}

The way you connect to {{site.data.keyword.messagehub}} varies depending on whether you're application is running natively or as a Cloud Foundry application. However, in both cases two pieces of information are required: 
{: shortdesc}

* The endpoint URLs for the APIs
* Credentials for authentication

Read the following information for how to obtain these details. The steps can vary subtly so ensure that you complete the appropriate steps for your instance.

For information about how to connect to {{site.data.keyword.messagehub}} if you're using the now deprecated Classic plan, see [Connecting using the Classic plan](/docs/EventStreams?topic=EventStreams-connecting_classic).


## Overview
{: #connect_enterprise}

Services provisioned using the Standard or the Enterprise plans are grouped in the dashboard under the heading **Services**. The plans are [IAM enabled ![External link icon](../../icons/launch-glyph.svg "External link icon")](/docs/iam?topic=iam-getstarted#getstarted){:new_window}. You don't need to understand IAM to get started but some knowledge is recommended if you want to secure your {{site.data.keyword.messagehub}} service. For more information, see 
[Managing access to your {{site.data.keyword.messagehub}} resources](/docs/EventStreams?topic=EventStreams-security).

Complete the following steps to bind your application and obtain Service Keys for your service. To be authorized to create topics, your application or Service Key must have a Manager access role.

To connect an application, the method used depends on where the application is deployed, that is in Cloud Foundry or deployed outside Cloud Foundry, for example in the Kubernetes Service.

## Provision an {{site.data.keyword.messagehub}} instance
{: #provision_instance}

As a prerequisite, you must first provision an {{site.data.keyword.messagehub}} service instance for either the Standard or Enterprise plan. Next, obtain {{site.data.keyword.messagehub}} API connection details by completing the following tasks.

## Connect applications 
{: #connect_enterprise_external}

For applications running outside Cloud Foundry, credentials are generated by creating a Service Key. When you obtain the Service Key, manually pass the details of the key to your application using your chosen method.

### Get credentials using the IBM Cloud console
{: #connect_enterprise_external_console}

1. Locate your {{site.data.keyword.messagehub}} service on the dashboard.
2. Click your service tile.
3. Click **Service Credentials**.
4. Click **New Credential**. 
5. Complete the details for your new credential like a name and role and click **Add**. A new credential appears in the credentials list.
6. Click this credential using **View Credentials** to reveal the details in JSON format.
7. Pass these credentials to your application. Specify <code>token</code> as your user name and the <var class="keyword varname">api_key</var> as your password. Separate <code>token</code> and the <var class="keyword varname">api_key</var> with a colon. For more information, see [Configuring your Kafka API client](/docs/EventStreams?topic=EventStreams-kafka_using#kafka_api_client).
   <br/><br/>Ensure that your application parses the details.

### Get credentials using the IBM Cloud CLI
{: #connect_enterprise_external_cli}

<ol>
<li>Locate your service:<br/>
<code>ibmcloud resource service-instances</code></li>
<li>Create a Service Key:<br/>
<code>ibmcloud resource service-key-create <var class="keyword varname">key_name</var> <var class="keyword varname">key_role</var> --instance-name <var class="keyword varname">your_service_name</var></code></li>
<li>Print the Service Key:<br/>
<code>ibmcloud resource service-key <var class="keyword varname">key_name</var></code></li>
<li>Pass these credentials to your application. Specify <code>token</code> as your user name and the <var class="keyword varname">api_key</var> as your password. Separate <code>token</code> and the <var class="keyword varname">api_key</var> with a colon. For more information, see [Configuring your client](/docs/EventStreams?topic=EventStreams-kafka_connect).
<p>Ensure that your application parses the details.</p></li>
</ol>

The endpoints in the service key are generated according to the service endpoints settings of the instance, for example, public endpoints are generated for `--service-endpoints=public`, and private endpoints are generated for `--service-endpoints=private`. However, for an instance that has `--service-endpoints=public-and-private`, public endpoints are generated by default. To generate private endpoints in the service key, use the following command: <code>ibmcloud resource service-key-create <private-key-name> <role> --instance-name <instance-name> --service-endpoint private<code>.
{:important}

## Connect Cloud Foundry applications
{: #connect_enterprise_cf}

Your application must be bound to the {{site.data.keyword.messagehub}} service instance. To bind a Cloud Foundry application to a non-Cloud Foundry service, create a Cloud Foundry service alias first and then reference this alias from your Cloud Foundry application when binding. 

When bound, the connection details are then made available to the application in JSON format using the VCAP_SERVICES environment variable. You can bind an application and service using either the [IBM Cloud console](/docs/EventStreams?topic=EventStreams-connecting#connect_enterprise_cf_console) or the [IBM Cloud CLI](/docs/EventStreams?topic=EventStreams-connecting#connect_enterprise_cf_cli).

### Bind an application using the IBM Cloud console
{: #connect_enterprise_cf_console}

1. Ensure that you're in the intended Cloud Foundry Organization and Space.
2. Locate your Cloud Foundry Application on the dashboard or create an application by clicking the **Create resource** button.
3. Click your application tile.
4. Click **Connections**.
5. Click **Create Connection**.
6. Select the {{site.data.keyword.messagehub}} service tile that you want to bind to and click **Connect**. 
7. In the **Connect IAM-Enabled Service** window that appears, select an access role from **Access Role for Connection** and a service ID from the **Service ID for Connection** list (you can accept the auto-generated ID). Click **Connect**. 

  This creates a Cloud Foundry service alias for your {{site.data.keyword.messagehub}} service and then binds your application to this alias. 

  Restage your application for the changes to take effect.<br/>
8. Click the **Runtime** tab on the left and select the **Environment variables** tab in the center. You can now verify your VCAP_SERVICES information. Your application can now access these as environment variables. 
 

### Bind an application using the IBM Cloud CLI
{: #connect_enterprise_cf_cli}

<ol>
<li>Ensure that you're in the intended Cloud Foundry Organization and Space. You can navigate interactively by running the following command:<br/>
 <code>ibmcloud target --cf</code></li>
<li>Locate your app:</br>
<code>ibmcloud app list</code><br/>
<br/>
If you have a manifest file, you can create a new app by running:<br/>
<code>ibmcloud app push</code><br/>
<br/>
Because the app is not bound to {{site.data.keyword.messagehub}} yet, the app cannot establish a connection. Therefore, you are recommended to push the application with the <code>--no-start</code> parameter to avoid unnecessary connection failures.</li>
<li>Locate your service:</br>
<code>ibmcloud resource service-instances</code></li>
<li>Create a Cloud Foundry service alias:<br/>
<code>ibmcloud resource service-alias-create <var class="keyword varname">alias_name</var> --instance-name <var class="keyword varname">your_service_name</var></code></li>
<li>Bind your app to the service alias created previously:<br/>
<code>ibmcloud service bind <var class="keyword varname">your_ app_name</var> <var class="keyword varname">alias_name</var></code>.<br/>
<br/>
Alternatively, you can update your manifest file and push the application again.</li>
<li>Verify that the VCAP_SERVICES environment variable is available in your application runtime:<br/>
<code>ibmcloud app env <var class="keyword varname">your_app_name</var></code></li>
<li>Pass these credentials to your application. Specify <code>token</code> as your user name and the <var class="keyword varname">api_key</var> as your password. Separate <code>token</code> and the <var class="keyword varname">api_key</var> with a colon. For more information, see [Configuring your client](/docs/EventStreams?topic=EventStreams-kafka_connect). 
<p>You might need to restage your application for the changes to take effect.</p></li>
</ol>


## What to do next
{: #after_connecting}

Now you have connection and credential information, you can choose an {{site.data.keyword.messagehub}} client. For more information, see [Using the Kafka API](/docs/EventStreams?topic=EventStreams-kafka_using).

<!--
Charlie said:

"Add some info describing how to take the information made available from above e.g. like the info in the Connecting a client to the Kafka API section of the alpha docs on stage 1? https://test.cloud.ibm.com/docs/EventStreams?topic=EventStreams-alpha_about#alpha_about"
-->
